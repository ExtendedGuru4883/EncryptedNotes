@page "/Notes"
@using System.Globalization
@using Client.Shared

<FluentStack Orientation="Orientation.Horizontal" HorizontalAlignment="HorizontalAlignment.SpaceBetween" class="mb-3">
<h3>Your notes</h3>
<FluentButton Appearance="Appearance.Accent" @onclick="HandleOpenAddNote">Add new note</FluentButton>
</FluentStack>

@foreach (var error in _errors)
{
    <div class="text-danger">@error</div>
}

<Virtualize Items="_notes" Context="note">
    <FluentCard @key="note.Id" Style="padding: 2rem; min-width: 320px;" class="mb-3">
        <FluentStack Orientation="Orientation.Vertical">
            <div>@note.Title</div>
            <FluentDivider Style="width: 100%;"></FluentDivider>
            <div>@note.Content</div>
            <FluentDivider Style="width: 100%;"></FluentDivider>
            <FluentStack Orientation="Orientation.Horizontal" HorizontalAlignment="HorizontalAlignment.SpaceBetween">
                <div>
                    <FluentButton Appearance="Appearance.Accent" @onclick="() => HandleOpenEditableNote(note)">
                        Edit
                    </FluentButton>
                    <FluentButton BackgroundColor="crimson" Color="white" @onclick="() => DeleteNoteAsync(note.Id)"
                                  disabled="@(_awaitingDeletionNoteId != Guid.Empty)">
                        @(_askConfirmDeletionNoteId == note.Id
                            ? _awaitingDeletionNoteId == note.Id
                                ? "Deleting..."
                                : "Confirm?"
                            : "Delete")
                    </FluentButton>
                </div>
                <div>@note.TimeStamp.ToString("d", CultureInfo.CurrentCulture)</div>
            </FluentStack>
        </FluentStack>
    </FluentCard>
</Virtualize>

@if (_shownEditableNote is not null)
{
    <FluentDialog>
        <EditableNote Note="_shownEditableNote" OnClose="HandleCloseEditableNote"></EditableNote>
    </FluentDialog>
}

@if (_showAddNote)
{
    <FluentDialog>
        <AddNote OnClose="HandleCloseAddNote"></AddNote>
    </FluentDialog>
}

@*TODO change to better feedback*@
@if (_loadingNotes)
{
    <div>Loading...</div>
}